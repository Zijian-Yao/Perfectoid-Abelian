\documentclass{standalone}
\usepackage{tikz}
\usetikzlibrary{arrows}

\begin{document}
\begin{tikzpicture}


\def\shift{5.5*0.75}

\def\Aoffset{0.15}
\pgfmathsetmacro\l{2*0.8}
\pgfmathsetmacro\L{4*0.8}

\def\s{0.33}
\def\S{0.35}

\def\Cl{4*0.75}

\pgfmathsetmacro\hoffset{\Cl/(4.55*0.75)*1.4}

\def\hshift{2.4*\Cl}

\def\A{1}
\def\B{0.1}
\def\C{0.2}
\def\D{1}
\pgfmathsetmacro\det{1/(\A*\D-\B*\C)}

\def\AA{1}
\def\CC{0}
\def\BB{-0.25}
\def\DD{0.5}

\begin{scope}

\pgftransformcm{\AA}{\CC}{\BB}{\DD}{\pgfpoint{0cm}{0cm}}

	\clip (-\Cl,-\Cl) rectangle (\Cl cm,\Cl cm); % Clips the picture...
	
	\filldraw[very thick,fill=white, fill opacity=1, draw=black] (-\Cl,-\Cl)
	rectangle (\Cl,\Cl);	
	
	\begin{scope}
	\pgftransformcm{\A}{\B}{\C}{\D}{\pgfpoint{0cm}{0cm}}
	% This is actually the transformation matrix entries that
	% gives the slanted unit vectors.
	\draw[dashed] (-2*\Cl,-2*\Cl) grid[step=\L cm,xshift=0.5*\L cm,yshift=0.5*\L cm] (3*\Cl,3*\Cl);
	% Draws a grid in the new coordinates.
	
	\foreach \x in {-4.5,-3.5,...,3.5}{% Two indices running over each
		\foreach \y in {-4.5,-3.5,...,3.5}{% node on the grid we have drawn 
			\node[draw,circle,inner sep=1.5pt,fill] at (\L*\x,\L*\y) {};
			% Places a dot at those points
		}
	}
	
	\end{scope}
	
	\foreach \x in {-4.5,-3.5,...,3.5}{% Two indices running over each
		\foreach \y in {-4.5,-3.5,...,3.5}{% node on the grid we have drawn 
			\filldraw[fill=gray, fill opacity=0.05, draw=black] (-\s*\L+\x*\L*\A+\y*\L*\C,-\s*\L+\x*\L*\B+\y*\L*\D)
			rectangle (\s*\L+\x*\L*\A+\y*\L*\C,\s*\L+\x*\L*\B+\y*\L*\D);
			
		}
	}
	
	\filldraw[fill=gray, fill opacity=0.4, draw=black] ({-\S*\L},{-\S*\L})
	rectangle ({\S*\L},{\S*\L});

\end{scope}



\pgfmathsetmacro\cl{\Cl*\l/\L} ;
\draw [thick,-latex] ({-\cl*(\AA+\BB)},{\shift-\cl*(\CC+\DD)}) -- ({-\Cl*(\AA+\BB)},{-\Cl*(\CC+\DD)});
\draw [thick,-latex] ({-\cl*\BB+\cl*\AA)},{\shift-\cl*(\CC+\DD)}) --({-\Cl*\BB+\Cl*\AA)},{\Cl*\CC-\Cl*\DD)});
\draw [thick,-latex] ({\cl*\BB+\cl*\AA)},{\shift+\cl*(\CC+\DD)}) --({\Cl*\BB+\Cl*\AA)},{\Cl*\CC+\Cl*\DD)});
\draw [thick,-latex] ({\cl*\BB-\cl*\AA)},{\shift+\cl*(\CC+\DD)}) --({\Cl*\BB-\Cl*\AA)},{-\Cl*\CC+\Cl*\DD)});

\draw [thick,-latex] (-\hshift+\Cl*1.05,\shift )--(-\Cl*1.05,\shift);


\def\A{1}
\def\B{0.1}
\def\C{0.2}
\def\D{1}




\begin{scope}[shift={(0,\shift)}]
\pgftransformcm{\AA}{\CC}{\BB}{\DD}{\pgfpoint{0cm}{0cm}}

\clip (-\Cl,-\Cl) rectangle (\Cl cm,\Cl cm); % Clips the picture...

	
	\filldraw[very thick,fill=white, fill opacity=1, draw=black] (-\Cl,-\Cl) 
	rectangle (\Cl,\Cl);
	\filldraw[very thick,fill=white, fill opacity=0.1, draw=black] (-\Cl*\l/\L,-\Cl*\l/\L) 
	rectangle (\Cl*\l/\L,\Cl*\l/\L);



	\filldraw[fill=gray, fill opacity=0.4, draw=black] ({-\S*\l},{-\S*\l})
	rectangle ({\S*\l},{\S*\l});
	
	\def\s{0.4};
	\def\S{0.35};
	
	\begin{scope}
	\pgftransformcm{\A}{\B}{\C}{\D}{\pgfpoint{0cm}{0cm}}
	% This is actually the transformation matrix entries that
	% gives the slanted unit vectors.

	\draw[dashed] (-2*\Cl,-2*\Cl) grid[step=\l cm,xshift=0.5*\l cm,yshift=0.5*\l cm] (7,7);
	% Draws a grid in the new coordinates.
	
	\foreach \x in {-4.5,-3.5,...,3.5}{% Two indices running over each
		\foreach \y in {-4.5,-3.5,...,3.5}{% node on the grid we have drawn 
			\node[draw,circle,inner sep=1.5pt,fill] at (\l*\x,\l*\y) {};
			% Places a dot at those points
		}
	}
	
	
	%\node at (0.5*\l,0.5*\l) {$D$};
	\end{scope}
	
	
	\foreach \x in {-4.5,-3.5,...,3.5}{% Two indices running over each
		\foreach \y in {-4.5,-3.5,...,3.5}{% node on the grid we have drawn 
			\filldraw[fill=gray, fill opacity=0.05, draw=black] (-\s*\l+\x*\l*\A+\y*\l*\C,-\s*\l+\x*\l*\B+\y*\l*\D)
			rectangle (\s*\l+\x*\l*\A+\y*\l*\C,\s*\l+\x*\l*\B+\y*\l*\D);
			
		}
	}

\end{scope}

\begin{scope}[shift={(-\hshift,\shift)}]
\pgftransformcm{\AA}{\CC}{\BB}{\DD}{\pgfpoint{0cm}{0cm}}


\clip (-\Cl,-\Cl) rectangle (\Cl cm,\Cl cm); % Clips the picture...


\filldraw[very thick,fill=white, fill opacity=1, draw=black] (-\Cl,-\Cl) 
rectangle (\Cl,\Cl);
%\filldraw[very thick,fill=white, fill opacity=0.1, draw=black] (-\Cl*\l/\L,-\Cl*\l/\L) 
%rectangle (\Cl*\l/\L,\Cl*\l/\L);


\begin{scope}
\pgftransformcm{\A}{\B}{\C}{\D}{\pgfpoint{0cm}{0cm}}
% This is actually the transformation matrix entries that
% gives the slanted unit vectors.

\draw[dashed] (-2*\Cl,-2*\Cl) grid[step=\L cm,xshift=0.5*\L cm,yshift=0.5*\L cm] (7,7);
% Draws a grid in the new coordinates.

\foreach \x in {-4.5,-3.5,...,3.5}{% Two indices running over each
	\foreach \y in {-4.5,-3.5,...,3.5}{% node on the grid we have drawn 
		\node[draw,circle,inner sep=1.5pt,fill] at (\L*\x,\L*\y) {};
		% Places a dot at those points
	}
}


%\node at (0.5*\l,0.5*\l) {$D$};
\end{scope}


\foreach \x in {-4,-3,...,3.5}{% Two indices running over each
	\foreach \y in {-4,-3,...,3.5}{% node on the grid we have drawn 
		\filldraw[fill=gray, fill opacity=0.05, draw=black] (-\s*\l+\x*\l*\A+\y*\l*\C,-\s*\l+\x*\l*\B+\y*\l*\D)
		rectangle (\s*\l+\x*\l*\A+\y*\l*\C,\s*\l+\x*\l*\B+\y*\l*\D);
		
	}
}
\foreach \x in {-0.5,0.5}{% Two indices running over each
	\foreach \y in {-0.5,0.5}{% node on the grid we have drawn 
		\filldraw[fill=gray, fill opacity=0.4, draw=black] (-\S*\l+\x*\l*\A+\y*\l*\C,-\S*\l+\x*\l*\B+\y*\l*\D)
		rectangle (\S*\l+\x*\l*\A+\y*\l*\C,\S*\l+\x*\l*\B+\y*\l*\D);
		
	}
}



\end{scope}


\pgfmathsetmacro\hoffset{\Cl/(4.55*0.75)*1.4}

\node(X) at ({-\hshift-0.5*\hoffset},+\hoffset) {$E/M$};
\node(Y)  [label={[label distance=-1.05cm]0:$E/M^{1/p^n}$}] at ({-\hshift+1.7*\hoffset},+\hoffset) {\phantom{$E/M$}};
\node(Z) at ({-\hshift+1.7*\hoffset},-0.5*\hoffset) {$E/M$};

\draw[-latex] (Y.south) -- (Z.north) node[midway,right] {$$};
\draw[-latex] (X.east) -- (Y.west) node[midway,above] {$v$};
\draw[-latex] (X.south) -- (Z.west) node[midway,below left] {$[p]$};

%\node(QQ) at (({\Cl*2.1},\shift) {$E_j^{1/p^n}$};
%\node(QQQ)  [label={[label distance=-1.05cm]0:$E/M^{1/p^n}$}] at ({\Cl*2.1+\hoffset},\shift) {\phantom{$E/M$}};

%\node(P) at ({\Cl*2.1-\hoffset},0) {$E$};
%\node(PP) at (({\Cl*2.1},0) {$E_j$};
%\node(PPP) at (({\Cl*2.1+\hoffset},0) {$E/M$};

%\draw[-latex] (QQ.south) -- (PP.north);
%\draw[left hook-latex] (PP.west) -- (P.east);
%\draw[left hook-latex] (QQ.west) -- (Q.east);
%\draw[right hook-latex] (QQ.east) -- (QQQ.west);
%\draw[right hook-latex] (PP.east) -- (PPP.west);
%\draw[-latex] (Q.south) -- (P.north) node[midway,right] {$[p^n]$};
%\draw[-latex] (QQQ.south) -- (PPP.north) node[midway,left] {$[p^n]$};
	%

\end{tikzpicture}
\end{document}